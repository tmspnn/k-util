var kutil=(()=>{var a=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var v=(e,t)=>{for(var i in t)a(e,i,{get:t[i],enumerable:!0})},E=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of y(t))!x.call(e,s)&&s!==i&&a(e,s,{get:()=>t[s],enumerable:!(r=b(t,s))||r.enumerable});return e};var g=e=>E(a({},"__esModule",{value:!0}),e);var _={};v(_,{Class:()=>f,CustomEventEmitter:()=>h,View:()=>d,kxhr:()=>u,stringToElement:()=>c,viewEventEmitter:()=>p});function f(e={}){function t(i={}){l(this,e),t._implementedInterfaces.forEach(r=>l(this,r)),l(this,i)}return Object.assign(t.prototype,e),t._isCustomClass=!0,t._implementedInterfaces=[],t.static=function(i){return Object.assign(t,i)},t.inherit=function(i){if(!i._isCustomClass)throw new TypeError("CustomClass.inherit requires a custom class, but received: "+String(i));return Object.setPrototypeOf(t.prototype,i.prototype),t},t.implement=function(...i){return t._implementedInterfaces=i,t},t}function l(e,t,i){let r=i||e;Object.keys(t).forEach(s=>{let n=t[s],o=typeof n;n==null||o=="number"||o=="string"||o=="boolean"||o=="symbol"?e[s]=n:typeof n=="function"?e[s]=n.bind(r):(e[s]=Array.isArray(n)?[]:{},l(e[s],n,r))})}var h=class{constructor(){this.displayName="CustomEventEmitter",this.subscriptions={}}on(t,i,r){let s={listener:i,context:r};this.subscriptions[t]?this.subscriptions[t].push(s):this.subscriptions[t]=[s]}off(t,i,r){this.subscriptions[t]&&(i?this.subscriptions[t].forEach((s,n)=>{s&&s.listener==i&&s.context==r&&(this.subscriptions[t][n]=null)}):this.subscriptions[t]=null)}emit(t,...i){this.subscriptions[t]&&this.subscriptions[t].forEach(r=>{r&&r.listener.call(r.context,...i)})}};function u(e,t="GET",i=null,r={}){let s={state:"pending",result:null,err:null,callbacks:[],xhr:new XMLHttpRequest};return s.xhr.open(t.toUpperCase(),e,!0),r.contentType&&s.xhr.setRequestHeader("Content-Type",r.contentType),r.headers&&Object.keys(r.headers).forEach(n=>{s.xhr.setRequestHeader(n,r.headers[n])}),s.xhr.withCredentials=r.withCredentials||!1,s.xhr.timeout=r.timeout||0,s.xhr.onload=A.bind(s),s.xhr.onerror=P.bind(s),s.next=L.bind(s),s.then=w.bind(s),s.catch=k.bind(s),s.cancel=T.bind(s),s.finally=j.bind(s),r.onProgress=="function"&&(s.xhr.upload?s.xhr.upload.onprogress=r.onProgress:s.xhr.onprogress=r.onProgress),typeof r.beforeSend=="function"&&r.beforeSend(s.xhr),setTimeout(()=>s.xhr.send(i)),s}function C(e){return e!=null&&typeof e=="object"&&typeof e.then=="function"}function w(e,t){return typeof e=="function"&&this.callbacks.push({type:"resolve",f:e}),typeof t=="function"&&this.callbacks.push({type:"reject",f:t}),this}function k(e){return this.then(null,e)}function j(e){return typeof e=="function"&&this.callbacks.push({type:"finally",f:e}),this}function T(){this.xhr.abort(),this.state="cancelled";for(var e=this.callbacks.length;--e;){let t=this.callbacks[e];if(t.type=="finally"){t.f(this.xhr);break}}}function A(){this.xhr.status>=200&&this.xhr.status<400?(this.state="resolved",this.result=this.xhr.response,this.next()):this.xhr.onerror()}function P(){this.state="rejected",this.err=new Error(this.xhr.response||this.xhr.statusText),this.next()}function L(){for(var e=0;e<this.callbacks.length;++e){let t=this.callbacks[e];if(C(this.result))t.type=="resolve"?this.result.then(t.f):t.type=="reject"?this.result.catch(t.f):t.type=="finally"&&this.result.finally(t.f);else if(this.state=="resolved"&&t.type=="resolve")try{this.result=t.f(this.result)}catch(i){this.state="rejected",this.err=i}else this.state=="rejected"&&t.type=="reject"?(this.result=t.f(this.err),this.state="resolved"):t.type=="finally"&&t.f(this.xhr)}}var S=new DOMParser;function c(e){return S.parseFromString(e,"text/html").body.firstChild}var p=new h,d=f({displayName:"CustomClass [[ View ]]",eventEmitter:p,element:null,refs:{},init(e){if(typeof e=="string")this.element=c(e);else if(typeof e=="object")this.element=e;else throw new TypeError(`View.init(strOrEl: string | HTMLElement) does not recognize ${String(e)}.`);return this.refs={self:this.element},this.traverse(this.element),this},traverse(e){if(e.hasAttribute("data-ref")){let i=e.getAttribute("data-ref");this.refs[i]=e}if(e.hasAttribute("data-click")){let i=e.getAttribute("data-click");typeof this[i]=="function"&&e.addEventListener("click",this[i].bind(this))}e.hasAttribute("data-on")&&e.getAttribute("data-on").split(";").forEach(r=>{let s=r.split(":").map(m=>m.trim()),n=s[0],o=s[1];typeof this[o]=="function"&&e.addEventListener(n,this[o])});for(var t=0;t<e.children.length;++t){let i=e.children[t];i.hasAttribute("data-view")||this.traverse(i)}},destroy(){document.body.contains(this.element)&&this.element.parentNode.removeChild(this.element),this.element=null,this.refs={}}});return g(_);})();
